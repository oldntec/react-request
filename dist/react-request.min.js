!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t(e.ReactRequest={},e.React)}(this,function(e,t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var y={};function v(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.url,r=e.method,n=e.responseType,o=void 0===n?"":n,s=e.body,i=void 0===s?"":s;return[void 0===t?"":t,(void 0===r?"":r).toUpperCase(),o,i].join("||")}function U(e){return!!y[e]}function m(e){var t=e.requestKey,r=e.res,n=e.err;(y[t]||[]).forEach(function(e){r?e.resolve(r):e.reject(n)}),y[t]=null}function E(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2],n=void 0,o=void 0;r?(n=r,o=t):t.responseType?(n=t,o={}):(n={},o=t);var s=n.responseType,i=void 0===s?"":s,u=n.dedupe,a=void 0===u||u,c=n.requestKey||v({url:e.url||e,method:o.method||e.method||"",body:o.body||e.body||""}),p=void 0;if(a){y[c]||(y[c]=[]);var f=y[c],l=!!f.length,d={};if(p=new Promise(function(e,t){d.resolve=e,d.reject=t}),f.push(d),l)return p}var h=fetch(e,o).then(function(t){var e=void 0;return e=i instanceof Function?i(t):i||(204===t.status?"text":"json"),t[e]().then(function(e){if(t.data=e,!a)return t;m({requestKey:c,res:t})},function(){if(t.data=null,!a)return t;m({requestKey:c,res:t})})},function(e){if(!a)return Promise.reject(e);m({requestKey:c,err:e})});return a?p:h}var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},T={};var r=function(e){function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var N=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));return N.isReadRequest=function(e){var t=e.toUpperCase();return"GET"===t||"HEAD"===t||"OPTIONS"===t},N.isLazy=function(){var e=N.props,t=e.lazy;return void 0===t?!N.isReadRequest(e.method):t},N.shouldCacheResponse=function(){var e=N.props,t=e.cacheResponse;return void 0===t?N.isReadRequest(e.method):t},N.getFetchPolicy=function(){var e=N.props,t=e.fetchPolicy;return void 0===t?N.isReadRequest(e.method)?"cache-first":"network-only":t},N.cancelExistingRequest=function(e){if(N.state.fetching&&null!==N._currentRequestKey){var t=Error(e);t.name="AbortError",N.onResponseReceived(F({},N.responseReceivedInfo,{error:t,hittingNetwork:!0}))}},N.fetchRenderProp=function(t){return new Promise(function(e){setTimeout(function(){N.fetchData(t,!0,e)})})},N.getRequestKey=function(e){if(e&&e.requestKey)return e.requestKey;if(e){var t=Object.assign({},N.props,e);return v({url:t.url,body:t.body,method:t.method.toUpperCase()})}if(N.props.requestKey)return N.props.requestKey;var r=N.props;return v({url:r.url,body:r.body,method:r.method.toUpperCase()})},N.fetchData=function(e,t,r){var n=N.props,o=n.requestName,s=n.dedupe,i=n.beforeFetch;N.cancelExistingRequest("New fetch initiated");var u=N.getRequestKey(e),a=Object.assign({},N.props,e);N._currentRequestKey=u;var c=a.url,p=a.body,f=a.credentials,l=a.headers,d=a.responseType,h=a.mode,y=a.cache,v=a.redirect,m=a.referrer,R=a.referrerPolicy,q=a.integrity,g=a.keepalive,b=a.signal,K=a.method.toUpperCase(),w=N.shouldCacheResponse(),P={body:p,credentials:f,headers:l,method:K,mode:h,cache:y,redirect:v,referrer:m,referrerPolicy:R,integrity:q,keepalive:g,signal:b},k={url:c,init:P,requestKey:u,responseType:d};N.responseReceivedInfo=k;var j=N.getFetchPolicy(),O=void 0;if("network-only"!==j&&!t)if(O=T[u]){if(N.onResponseReceived(F({},k,{response:O,hittingNetwork:!1,stillFetching:"cache-and-network"===j})),"cache-first"===j||"cache-only"===j)return Promise.resolve(O)}else if("cache-only"===j){var C=Error('Response for "'+o+'" not found in cache.');return N.onResponseReceived(F({},k,{error:C,hittingNetwork:!1})),Promise.resolve(C)}N.setState({requestKey:u,url:c,error:null,failed:!1,fetching:!0});var _=!U(u)||!s;return _&&i({url:c,init:P,requestKey:u}),E(c,P,{requestKey:u,responseType:d,dedupe:s}).then(function(e){return w&&(T[u]=e),N._currentRequestKey===u&&N.onResponseReceived(F({},k,{response:e,hittingNetwork:_,resolve:r})),e},function(e){return N._currentRequestKey===u&&N.onResponseReceived(F({},k,{error:e,cachedResponse:O,hittingNetwork:_,resolve:r})),e})},N.onResponseReceived=function(e){var t=e.error,r=void 0===t?null:t,n=e.response,o=void 0===n?null:n,s=e.hittingNetwork,i=e.url,u=e.init,a=e.requestKey,c=e.cachedResponse,p=e.stillFetching,f=void 0!==p&&p,l=e.resolve;N.responseReceivedInfo=null,f||(N._currentRequestKey=null);var d=void 0;o&&o.data?d=o.data:c&&c.data&&(d=c.data),d=d?N.props.transformData(d):null,r&&N.state.data&&(d=N.state.data);var h={url:i,init:u,requestKey:a,error:r,failed:!!(r||o&&!o.ok),response:o,data:d,didUnmount:!!N.willUnmount};"function"==typeof l&&l(h),s&&N.props.afterFetch(h),N.willUnmount||N.setState({url:i,data:d,error:r,response:o,fetching:f,requestKey:a},function(){return N.props.onResponse(r,o)})},N.state={requestKey:e.requestKey||v(F({},e,{method:e.method.toUpperCase()})),requestName:e.requestName,fetching:!1,response:null,data:null,error:null,url:e.url},N}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,t.Component),n(r,[{key:"render",value:function(){var e=this.props,t=e.children,r=this.state,n=r.response,o=r.error;return t&&t({requestName:e.requestName,url:r.url,fetching:r.fetching,failed:!!(o||n&&!n.ok),response:n,data:r.data,requestKey:r.requestKey,error:o,doFetch:this.fetchRenderProp})||null}}]),n(r,[{key:"componentDidMount",value:function(){this.isLazy()||this.fetchData()}},{key:"componentDidUpdate",value:function(e){var t=this.props.requestKey||v(F({},this.props,{method:this.props.method.toUpperCase()}));t===(e.requestKey||v(F({},e,{method:e.method.toUpperCase()})))||this.isLazy()||this.fetchData({requestKey:t})}},{key:"componentWillUnmount",value:function(){this.willUnmount=!0,this.cancelExistingRequest("Component unmounted")}}]),r}();r.defaultProps={requestName:"anonymousRequest",onResponse:function(){},beforeFetch:function(){},afterFetch:function(){},transformData:function(e){return e},dedupe:!0,method:"get",referrerPolicy:"",integrity:"",referrer:"about:client"},e.Fetch=r,e.fetchDedupe=E,e.getRequestKey=v,e.isRequestInFlight=U,e.clearRequestCache=function(){y={}},e.clearResponseCache=function(){T={}},Object.defineProperty(e,"__esModule",{value:!0})});
